<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor-Patient Interactive Conversation</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üé§ Doctor-Patient Interactive Conversation</h1>
            <p>Real-time Speech-to-Text & Two-Way Translation powered by Soniox</p>
            
            <!-- Participant Info Display -->
            <div id="participant-info" class="participant-info" style="display: none;">
                <span class="participant-tag">üë®‚Äç‚öïÔ∏è <strong id="current-doctor-name">-</strong></span>
                <span class="participant-separator">‚Üî</span>
                <span class="participant-tag">üë§ <strong id="current-patient-name">-</strong></span>
            </div>
        </header>

        <!-- Controls Section -->
        <section class="controls-section">
            <div class="control-row">
                <!-- Language Selection -->
                <div class="language-group">
                    <div class="language-control">
                        <label for="doctor-lang">üè• Doctor Language:</label>
                        <select id="doctor-lang">
                            <option value="en">English (en)</option>
                            <option value="es">Spanish (es)</option>
                            <option value="fr">French (fr)</option>
                            <option value="de">German (de)</option>
                            <option value="hi">Hindi (hi)</option>
                            <option value="te">Telugu (te)</option>
                            <option value="ta">Tamil (ta)</option>
                            <option value="kn">Kannada (kn)</option>
                            <option value="ml">Malayalam (ml)</option>
                            <option value="mr">Marathi (mr)</option>
                            <option value="gu">Gujarati (gu)</option>
                            <option value="bn">Bengali (bn)</option>
                            <option value="pa">Punjabi (pa)</option>
                            <option value="or">Odia (or)</option>
                            <option value="as">Assamese (as)</option>
                            <option value="ur">Urdu (ur)</option>
                        </select>
                    </div>

                    <div class="language-control">
                        <label for="patient-lang">üë§ Patient Language:</label>
                        <select id="patient-lang">
                            <option value="en">English (en)</option>
                            <option value="es">Spanish (es)</option>
                            <option value="fr">French (fr)</option>
                            <option value="de">German (de)</option>
                            <option value="hi">Hindi (hi)</option>
                            <option value="te">Telugu (te)</option>
                            <option value="ta">Tamil (ta)</option>
                            <option value="kn">Kannada (kn)</option>
                            <option value="ml">Malayalam (ml)</option>
                            <option value="mr">Marathi (mr)</option>
                            <option value="gu">Gujarati (gu)</option>
                            <option value="bn">Bengali (bn)</option>
                            <option value="pa">Punjabi (pa)</option>
                            <option value="or">Odia (or)</option>
                            <option value="as">Assamese (as)</option>
                            <option value="ur">Urdu (ur)</option>
                        </select>
                    </div>
                </div>

                <!-- Main Buttons -->
                <div class="button-group">
                    <button id="select-participants-btn" class="btn btn-primary" title="Select doctor and patient">
                        üë• Select Participants
                    </button>
                    <button id="start-btn" class="btn btn-success" disabled title="Start recording conversation">
                        üéôÔ∏è Start Conversation
                    </button>
                    <button id="stop-btn" class="btn btn-danger" disabled title="Stop recording and save">
                        ‚õî Stop Conversation
                    </button>
                    <button id="clear-btn" class="btn btn-secondary" title="Clear all boxes">
                        üóëÔ∏è Clear
                    </button>
                    <button onclick="window.location.href='/medical-summary'" class="btn btn-primary" title="Generate medical summary from text">
                        üìÑ Medical Summary Generator
                    </button>
                </div>
            </div>

            <!-- Status and Options -->
            <div class="status-row">
                <div class="status-box">
                    <span class="status-label">Status:</span>
                    <span id="status-text" class="status-value">Ready</span>
                </div>

                <div class="timer-box">
                    <span class="timer-label">Duration:</span>
                    <span id="timer" class="timer-value">00:00</span>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="auto-scroll" checked>
                        üìå Auto-scroll
                    </label>
                </div>
            </div>
        </section>

        <!-- Completion Banner (hidden by default) -->
        <section id="completion-banner" class="completion-banner" style="display: none;">
            <div class="banner-content">
                <span class="banner-icon">‚úÖ</span>
                <span class="banner-text" id="banner-text">Conversation completed. Preparing medical documentation‚Ä¶</span>
            </div>
        </section>

        <!-- Three Boxes Section -->
        <section class="boxes-section">
            <!-- Box 1: Original -->
            <div class="box box-1">
                <div class="box-header">
                    <h2>üü¶ Box #1: Original Conversation</h2>
                    <span class="box-info">Raw transcription with speaker tags</span>
                </div>
                <div class="box-content" id="box-original">
                    <p class="placeholder">[Waiting for conversation to start...]</p>
                </div>
            </div>

            <!-- Box 2: Doctor Language -->
            <div id="box-doctor-container" class="box box-2">
                <div class="box-header">
                    <h2>üü© Box #2: Doctor's View</h2>
                    <span class="box-info" id="box-doctor-lang">English</span>
                </div>
                <div class="box-content" id="box-doctor">
                    <p class="placeholder">[Waiting for conversation to start...]</p>
                </div>
            </div>

            <!-- Box 3: Patient Language -->
            <div id="box-patient-container" class="box box-3">
                <div class="box-header">
                    <h2>üü® Box #3: Patient's View</h2>
                    <span class="box-info" id="box-patient-lang">Patient Language</span>
                </div>
                <div class="box-content" id="box-patient">
                    <p class="placeholder">[Waiting for conversation to start...]</p>
                </div>
            </div>
        </section>

        <!-- Medical Summary & Conclusion Section (hidden by default) -->
        <section id="medical-summary-section" class="medical-summary-section" style="display: none;">
            <div class="summary-container">
                <div class="summary-panel">
                    <div class="summary-header" id="clinical-summary-header">
                        <h2>ü©∫ Clinical Summary</h2>
                        <button class="toggle-btn">‚ñº</button>
                    </div>
                    <div class="summary-content" id="clinical-summary-content">
                        <p class="placeholder">Loading...</p>
                    </div>
                </div>
                <div class="summary-panel">
                    <div class="summary-header" id="conclusion-header">
                        <h2>üìå Conclusion & Follow-up</h2>
                        <button class="toggle-btn">‚ñº</button>
                    </div>
                    <div class="summary-content" id="conclusion-content">
                        <p class="placeholder">Loading...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- PDF Generation Section (hidden by default) -->
        <section id="pdf-section" class="pdf-section" style="display: none;">
            <h3>üìÑ Generate Medical Documentation</h3>
            <div class="pdf-buttons">
                <button id="pdf-conversation-btn" class="btn btn-pdf" title="Generate full conversation transcript PDF">
                    üìã Download Full Conversation
                </button>
                <button id="pdf-patient-summary-btn" class="btn btn-pdf" title="Generate patient summary PDF">
                    üë§ Download Patient Summary
                </button>
                <button id="pdf-research-btn" class="btn btn-pdf" title="Generate medical research notes PDF">
                    üî¨ Download Medical Research Notes
                </button>
            </div>
            <div id="pdf-status" class="pdf-status"></div>
        </section>

        <!-- Export Section -->
        <section class="export-section">
            <button id="download-btn" class="btn btn-info" disabled title="Download all boxes as JSON">
                üíæ Download JSON
            </button>
            <button id="export-txt-btn" class="btn btn-info" disabled title="Export as formatted text">
                üìÑ Export Text
            </button>
            <span id="export-status" class="export-status"></span>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>
                Powered by <strong>Soniox AI</strong> ‚Ä¢ 
                Built with <strong>FastAPI</strong> & <strong>LangChain</strong> ‚Ä¢ 
                Real-time Translation & Speaker Diarization
            </p>
        </footer>
    </div>

    <!-- Participant Selection Modal -->
    <div id="participant-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë• Select Doctor and Patient</h2>
                <span class="close-modal">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="doctor-search">üë®‚Äç‚öïÔ∏è Search Doctor:</label>
                    <input 
                        type="text" 
                        id="doctor-search" 
                        class="form-input" 
                        placeholder="Type doctor's name..."
                        autocomplete="off"
                    />
                    <div id="doctor-suggestions" class="autocomplete-suggestions"></div>
                    <div id="doctor-info" class="participant-detail"></div>
                </div>
                
                <div class="form-group">
                    <label for="patient-search">üë§ Search Patient:</label>
                    <input 
                        type="text" 
                        id="patient-search" 
                        class="form-input" 
                        placeholder="Type patient's name..."
                        autocomplete="off"
                    />
                    <div id="patient-suggestions" class="autocomplete-suggestions"></div>
                    <div id="patient-info" class="participant-detail"></div>
                </div>
                
                <div id="modal-error" class="modal-error"></div>
            </div>
            
            <div class="modal-footer">
                <button id="confirm-participants-btn" class="btn btn-primary" disabled>
                    ‚úì Confirm Selection
                </button>
                <button id="cancel-modal-btn" class="btn btn-secondary">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="modal" style="display: none;">
        <div class="modal-content error-modal-content">
            <div class="modal-header error-modal-header">
                <h2>‚ö†Ô∏è <span id="error-modal-title">Error</span></h2>
                <span class="close-error-modal">&times;</span>
            </div>
            
            <div class="modal-body">
                <p id="error-modal-message" class="error-message"></p>
            </div>
            
            <div class="modal-footer">
                <button id="error-modal-retry-btn" class="btn btn-primary" style="display: none;">
                    üîÑ Retry
                </button>
                <button id="error-modal-close-btn" class="btn btn-secondary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Post-Recording Summary Modal -->
    <div id="summary-modal" class="modal" style="display: none;">
        <div class="modal-content summary-modal-content">
            <div class="modal-header">
                <h2>Doctor-Patient Conversation Segments</h2>
                <p class="modal-subtitle">Voice Diarization Results</p>
            </div>
            
            <div class="modal-body summary-modal-body">
                <!-- Participant Info -->
                <div class="summary-section info-section">
                    <div class="info-grid">
                        <div><strong>Doctor:</strong> <span id="summary-doctor-name"></span></div>
                        <div><strong>Patient:</strong> <span id="summary-patient-name"></span></div>
                        <div><strong>Processing Date:</strong> <span id="summary-date"></span></div>
                    </div>
                </div>

                <!-- Processing Information -->
                <div class="summary-section">
                    <h3 class="section-title">Processing Information</h3>
                    <div class="info-box">
                        <p><strong>Voice Diarization:</strong> OpenAI-based Speaker Separation</p>
                        <p><strong>Transcription Engine:</strong> Whisper</p>
                        <p><strong>Language Majorly Spoken:</strong> <span id="summary-language"></span></p>
                        <p><strong>Total Segments:</strong> <span id="summary-segments"></span></p>
                    </div>
                </div>

                <!-- Conversation Segments -->
                <div class="summary-section">
                    <h3 class="section-title">Conversation Segments:</h3>
                    <div id="conversation-segments" class="segments-container"></div>
                </div>

                <!-- Complete Transcript (Editable) -->
                <div class="summary-section">
                    <h3 class="section-title">Complete Transcript (Editable):</h3>
                    <div class="warning-banner">Doctor, please edit accordingly</div>
                    <textarea id="transcript-editor" class="transcript-editor" rows="10"></textarea>
                </div>

                <!-- Generate Summary Button -->
                <div class="summary-section center">
                    <button id="generate-summary-btn" class="btn btn-success btn-lg">
                        Generate Medical Summary & Recommendations
                    </button>
                    <div id="generating-indicator" class="generating-indicator" style="display: none;">
                        <span class="spinner"></span> Generating with AI...
                    </div>
                </div>

                <!-- Medical Summary (Editable) -->
                <div id="medical-summary-section" class="summary-section" style="display: none;">
                    <h3 class="section-title">Medical Summary (Editable):</h3>
                    <div class="warning-banner">Doctor, please review and edit accordingly</div>
                    <textarea id="summary-editor" class="transcript-editor" rows="8" placeholder="AI-generated medical summary will appear here..."></textarea>
                </div>

                <!-- Conclusion & Recommendations (Editable) -->
                <div id="conclusion-section" class="summary-section" style="display: none;">
                    <h3 class="section-title">Conclusion & Recommendations (Editable):</h3>
                    <div class="warning-banner">Doctor, please review and edit accordingly</div>
                    <textarea id="conclusion-editor" class="transcript-editor" rows="8" placeholder="AI-generated conclusion and recommendations will appear here..."></textarea>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="save-pdf-btn" class="btn btn-success" disabled>
                    üíæ Save as PDF
                </button>
                <button id="close-summary-modal-btn" class="btn btn-secondary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
